eb<!-- ç§‘æŠ€é£æ ¼å¸ƒå±€ -->
<view class="tech-container">
  <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
  <view class="tech-navbar">
    <view class="navbar-logo">
      <view class="logo-icon">
        <text class="logo-text">MQTT</text>
      </view>
      <view class="logo-line"></view>
      <text class="logo-subtitle">æ§åˆ¶ä¸­å¿ƒ</text>
    </view>
    <view class="status-indicator {{connectionStatus}}">
      <view class="status-ring">
        <view class="status-pulse"></view>
      </view>
      <text class="status-label">{{connectionText}}</text>
    </view>
  </view>

  <!-- ä¸»å†…å®¹åŒºåŸŸ -->
  <scroll-view class="tech-content" scroll-y="true">
    <!-- é¦–é¡µ -->
    <view wx:if="{{activeTab === 'home'}}">
      <!-- ç§‘æŠ€æ„ŸçŠ¶æ€å¡ç‰‡ -->
      <view class="tech-status-card">
        <!-- èƒŒæ™¯è£…é¥° -->
        <view class="tech-bg-grid">
          <view class="grid-line"></view>
          <view class="grid-line"></view>
          <view class="grid-line"></view>
        </view>
        <view class="tech-circle"></view>

        <!-- æ ¸å¿ƒçŠ¶æ€å±•ç¤º -->
        <view class="status-center">
          <view class="status-hexagon {{connectionStatus}}">
            <view class="hexagon-inner">
              <image
                src="{{isConnected ? '/assets/icons/connect.svg' : '/assets/icons/wifi.svg'}}"
                class="status-icon-img"
                mode="aspectFit"
              />
            </view>
            <view class="hexagon-glow"></view>
          </view>
          <text class="status-text-main">{{isConnected ? 'ç³»ç»Ÿåœ¨çº¿' : 'ç¦»çº¿çŠ¶æ€'}}</text>
          <text class="status-tech-info">{{debugInfo || 'ç­‰å¾…è¿æ¥æŒ‡ä»¤'}}</text>
        </view>

        <!-- ç§‘æŠ€æ„Ÿè¿æ¥æŒ‰é’® -->
        <view class="connect-control">
          <button class="tech-button {{connectionStatus}}" bindtap="{{isConnected ? 'disconnect' : 'connect'}}">
            <view class="button-glow"></view>
            <view class="button-content">
              <text class="button-icon">{{isConnected ? 'âš¡' : 'ğŸ”Œ'}}</text>
              <text class="button-text">{{isConnected ? 'æ–­å¼€è¿æ¥' : 'å»ºç«‹è¿æ¥'}}</text>
            </view>
          </button>
        </view>

        <!-- åº•éƒ¨æ•°æ®æ¡ -->
        <view class="status-data-bar">
          <view class="data-item">
            <text class="data-value">{{subscribedTopics.length}}</text>
            <text class="data-label">è®¢é˜…ä¸»é¢˜</text>
          </view>
          <view class="data-divider"></view>
          <view class="data-item">
            <text class="data-value">{{messages.length}}</text>
            <text class="data-label">æ¶ˆæ¯æ€»æ•°</text>
          </view>
          <view class="data-divider"></view>
          <view class="data-item">
            <text class="data-value">{{isConnected ? '1' : '0'}}</text>
            <text class="data-label">è¿æ¥çŠ¶æ€</text>
          </view>
        </view>
      </view>

      <!-- ç§‘æŠ€æ„ŸåŠŸèƒ½ç½‘æ ¼ -->
      <view class="tech-feature-section">
        <view class="section-header">
          <text class="section-title-tech">å¿«æ·æ“ä½œ</text>
          <view class="section-decoration"></view>
        </view>
        <view class="tech-feature-grid">
          <view class="tech-feature-card {{isConnected ? '' : 'disabled'}}" bindtap="{{isConnected ? 'showTestDialog' : 'showConnectFirst'}}">
            <view class="tech-card-bg"></view>
            <view class="tech-icon-box test">
              <image src="/assets/icons/test.svg" class="feature-icon-img" mode="aspectFit" />
              <view class="icon-glow"></view>
            </view>
            <text class="tech-card-label">å‘é€æµ‹è¯•</text>
            <view class="tech-corner tl"></view>
            <view class="tech-corner tr"></view>
            <view class="tech-corner bl"></view>
            <view class="tech-corner br"></view>
          </view>
          <view class="tech-feature-card" bindtap="clearMessages">
            <view class="tech-card-bg"></view>
            <view class="tech-icon-box clear">
              <image src="/assets/icons/clear.svg" class="feature-icon-img" mode="aspectFit" />
              <view class="icon-glow"></view>
            </view>
            <text class="tech-card-label">æ¸…ç©ºè®°å½•</text>
            <view class="tech-corner tl"></view>
            <view class="tech-corner tr"></view>
            <view class="tech-corner bl"></view>
            <view class="tech-corner br"></view>
          </view>
          <view class="tech-feature-card" bindtap="switchTab" data-tab="messages">
            <view class="tech-card-bg"></view>
            <view class="tech-icon-box message">
              <image src="/assets/icons/message.svg" class="feature-icon-img" mode="aspectFit" />
              <view class="icon-glow"></view>
            </view>
            <text class="tech-card-label">æ¶ˆæ¯åˆ—è¡¨</text>
            <view class="tech-corner tl"></view>
            <view class="tech-corner tr"></view>
            <view class="tech-corner bl"></view>
            <view class="tech-corner br"></view>
          </view>
          <view class="tech-feature-card" bindtap="switchTab" data-tab="settings">
            <view class="tech-card-bg"></view>
            <view class="tech-icon-box settings">
              <image src="/assets/icons/settings.svg" class="feature-icon-img" mode="aspectFit" />
              <view class="icon-glow"></view>
            </view>
            <text class="tech-card-label">ç³»ç»Ÿè®¾ç½®</text>
            <view class="tech-corner tl"></view>
            <view class="tech-corner tr"></view>
            <view class="tech-corner bl"></view>
            <view class="tech-corner br"></view>
          </view>
        </view>
      </view>

      <!-- ç§‘æŠ€æ„Ÿè®¢é˜…åŒºåŸŸ -->
      <view class="tech-card">
        <view class="tech-card-header">
          <text class="tech-card-title">ä¸»é¢˜è®¢é˜…</text>
          <view class="tech-badge">{{subscribedTopics.length}}</view>
        </view>
        <view class="tech-input-wrapper">
          <view class="tech-input-bg"></view>
          <input class="tech-input" placeholder="è¾“å…¥è®¢é˜…ä¸»é¢˜..." value="{{newTopic}}" bindinput="onTopicInput" disabled="{{!isConnected}}" />
          <button class="tech-action-btn" bindtap="subscribeTopic" disabled="{{!isConnected}}">
            <image src="/assets/icons/subscribe.svg" class="action-icon-img" mode="aspectFit" />
          </button>
        </view>
        <view class="tech-tag-container">
          <view wx:for="{{subscribedTopics}}" wx:key="*this" class="tech-tag">
            <text class="tech-tag-text">{{item}}</text>
            <view class="tech-tag-close" bindtap="unsubscribeTopic" data-topic="{{item}}">Ã—</view>
            <view class="tech-tag-line"></view>
          </view>
          <view wx:if="{{subscribedTopics.length === 0}}" class="tech-empty">
            <text class="empty-icon">âšª</text>
            <text class="empty-text">æš‚æ— è®¢é˜…ä¸»é¢˜</text>
          </view>
        </view>
      </view>

      <!-- ç§‘æŠ€æ„Ÿå‘å¸ƒåŒºåŸŸ -->
      <view class="tech-card">
        <view class="tech-card-header">
          <text class="tech-card-title">æ¶ˆæ¯å‘å¸ƒ</text>
          <view class="tech-deco-line"></view>
        </view>
        <view class="tech-input-group">
          <view class="tech-input-bg"></view>
          <input class="tech-input" placeholder="ç›®æ ‡ä¸»é¢˜" value="{{publishTopic}}" bindinput="onPublishTopicInput" disabled="{{!isConnected}}" />
        </view>
        <view class="tech-input-group" style="margin-top: 12px;">
          <view class="tech-input-bg"></view>
          <textarea class="tech-textarea" placeholder="æ¶ˆæ¯å†…å®¹..." value="{{publishMessage}}" bindinput="onPublishMessageInput" disabled="{{!isConnected}}" />
        </view>
        <button class="tech-submit-btn" bindtap="publishMessage" disabled="{{!isConnected}}">
          <view class="btn-gradient"></view>
          <image src="/assets/icons/publish.svg" class="submit-icon-img" mode="aspectFit" />
          <text class="btn-label">å‘é€æ¶ˆæ¯</text>
          <view class="btn-particles"></view>
        </button>
      </view>

      <!-- ç§‘æŠ€æ„Ÿæœ€è¿‘æ¶ˆæ¯ -->
      <view class="tech-card">
        <view class="tech-card-header">
          <text class="tech-card-title">æ¶ˆæ¯å†å²</text>
          <view class="tech-link" bindtap="switchTab" data-tab="messages">
            <text>æŸ¥çœ‹å…¨éƒ¨</text>
            <text class="arrow">â†’</text>
          </view>
        </view>
        <view class="tech-message-list">
          <view wx:for="{{messages.slice(0, 4)}}" wx:key="index" class="tech-message-item {{item.direction || 'received'}}">
            <view class="tech-msg-dot {{item.direction || 'received'}}">
              <view class="dot-inner"></view>
            </view>
            <view class="tech-msg-content">
              <view class="tech-msg-topic">{{item.topic}}</view>
              <view class="tech-msg-payload">{{item.payload.length > 50 ? item.payload.substring(0, 50) + '...' : item.payload}}</view>
            </view>
            <text class="tech-msg-time">{{item.timestamp}}</text>
            <view class="tech-msg-line"></view>
          </view>
          <view wx:if="{{messages.length === 0}}" class="tech-empty">
            <text class="empty-icon">ğŸ“­</text>
            <text class="empty-text">æš‚æ— æ¶ˆæ¯è®°å½•</text>
          </view>
        </view>
      </view>
    </view>

    <!-- æ¶ˆæ¯é¡µé¢ -->
    <view wx:if="{{activeTab === 'messages'}}">
      <view class="tech-card">
        <view class="tech-filter-bar">
          <view class="tech-filter-tabs">
            <view class="tech-filter-tab {{messageType === 'all' ? 'active' : ''}}" bindtap="onFilterTagTap" data-type="all">
              <text class="tab-text">å…¨éƒ¨</text>
              <view class="tab-underline"></view>
            </view>
            <view class="tech-filter-tab {{messageType === 'received' ? 'active' : ''}}" bindtap="onFilterTagTap" data-type="received">
              <text class="tab-text">æ¥æ”¶</text>
              <view class="tab-underline"></view>
            </view>
            <view class="tech-filter-tab {{messageType === 'sent' ? 'active' : ''}}" bindtap="onFilterTagTap" data-type="sent">
              <text class="tab-text">å‘é€</text>
              <view class="tab-underline"></view>
            </view>
          </view>
          <view class="tech-search-box">
            <image src="/assets/icons/search.svg" class="search-icon-img" mode="aspectFit" />
            <input class="tech-search-input" placeholder="æœç´¢æ¶ˆæ¯..." value="{{filterKeyword}}" bindinput="onFilterKeywordInput" />
          </view>
        </view>
      </view>

      <view class="tech-card">
        <view class="tech-list-header">
          <text class="list-count">{{filteredMessages.length}} æ¡æ¶ˆæ¯</text>
          <view class="list-divider"></view>
        </view>
        <view class="tech-full-list">
          <view wx:for="{{filteredMessages}}" wx:key="index" class="tech-full-item {{item.direction || 'received'}}">
            <view class="item-header">
              <view class="type-badge {{item.direction || 'received'}}">
                <text>{{item.direction === 'sent' ? 'â†‘ å‘é€' : 'â†“ æ¥æ”¶'}}</text>
              </view>
              <text class="item-time">{{item.timestamp}}</text>
            </view>
            <view class="item-body">
              <text class="item-topic">{{item.topic}}</text>
              <text class="item-payload">{{item.payload}}</text>
            </view>
            <view class="item-decoration"></view>
          </view>
          <view wx:if="{{filteredMessages.length === 0}}" class="tech-empty">
            <text class="empty-icon">ğŸ”</text>
            <text class="empty-text">æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„æ¶ˆæ¯</text>
          </view>
        </view>
      </view>

      <view class="tech-card">
        <view class="tech-export-grid">
          <button class="tech-export-btn" bindtap="exportMessagesAsJson">
            <view class="export-icon">ğŸ“„</view>
            <text class="export-label">å¯¼å‡º JSON</text>
          </button>
          <button class="tech-export-btn" bindtap="exportMessagesAsCsv">
            <view class="export-icon">ğŸ“Š</view>
            <text class="export-label">å¯¼å‡º CSV</text>
          </button>
        </view>
      </view>
    </view>

    <!-- è®¾ç½®é¡µé¢ -->
    <view wx:if="{{activeTab === 'settings'}}">
      <view class="tech-card">
        <view class="tech-card-header">
          <text class="tech-card-title">æœåŠ¡å™¨é…ç½®</text>
          <view class="tech-deco-line"></view>
        </view>
        <view class="tech-form-list">
          <view class="tech-form-item">
            <text class="tech-form-label">æœåŠ¡å™¨åœ°å€</text>
            <view class="tech-input-bg"></view>
            <input class="tech-input" value="{{serverConfig.broker}}" bindinput="onBrokerInput" />
          </view>
          <view class="tech-form-item">
            <text class="tech-form-label">ç«¯å£</text>
            <view class="tech-input-bg"></view>
            <input class="tech-input" type="number" value="{{serverConfig.port}}" bindinput="onPortInput" />
          </view>
          <view class="tech-form-item">
            <text class="tech-form-label">åè®®</text>
            <picker mode="selector" range="{{['wss', 'ws']}}" value="{{serverConfig.protocol === 'wss' ? 0 : 1}}" bindchange="onProtocolChange">
              <view class="tech-picker">{{serverConfig.protocol}}</view>
            </picker>
          </view>
          <view class="tech-form-item">
            <text class="tech-form-label">å®¢æˆ·ç«¯ID</text>
            <view class="tech-input-bg"></view>
            <input class="tech-input" value="{{serverConfig.clientId}}" bindinput="onClientIdInput" />
          </view>
          <view class="tech-form-item">
            <text class="tech-form-label">ç”¨æˆ·å</text>
            <view class="tech-input-bg"></view>
            <input class="tech-input" value="{{serverConfig.username}}" bindinput="onUsernameInput" />
          </view>
          <view class="tech-form-item">
            <text class="tech-form-label">å¯†ç </text>
            <view class="tech-input-bg"></view>
            <input class="tech-input" password="{{!showPassword}}" value="{{serverConfig.password}}" bindinput="onPasswordInput" />
          </view>
        </view>
        <view class="tech-action-row">
          <button class="tech-btn-secondary" bindtap="resetToDefault">
            <text class="btn-icon">â†º</text>
            <text>é‡ç½®</text>
          </button>
          <button class="tech-btn-primary" bindtap="saveServerConfig">
            <text class="btn-icon">ğŸ’¾</text>
            <text>ä¿å­˜é…ç½®</text>
          </button>
        </view>
      </view>

      <view class="tech-card">
        <view class="tech-card-header">
          <text class="tech-card-title">æ•°æ®ç»Ÿè®¡</text>
          <view class="tech-deco-line"></view>
        </view>
        <view class="tech-stats-grid">
          <view class="tech-stat-box">
            <view class="stat-icon receive">
              <text>â†“</text>
            </view>
            <text class="stat-number">{{receivedMessageCount}}</text>
            <text class="stat-tag">æ¥æ”¶æ¶ˆæ¯</text>
            <view class="stat-glow"></view>
          </view>
          <view class="tech-stat-box">
            <view class="stat-icon send">
              <text>â†‘</text>
            </view>
            <text class="stat-number">{{sentMessageCount}}</text>
            <text class="stat-tag">å‘é€æ¶ˆæ¯</text>
            <view class="stat-glow"></view>
          </view>
          <view class="tech-stat-box">
            <view class="stat-icon topic">
              <text>#</text>
            </view>
            <text class="stat-number">{{subscribedTopics.length}}</text>
            <text class="stat-tag">è®¢é˜…ä¸»é¢˜</text>
            <view class="stat-glow"></view>
          </view>
        </view>
      </view>
    </view>

    <!-- åº•éƒ¨ç•™ç™½ -->
    <view class="tech-bottom-spacer"></view>
  </scroll-view>

  <!-- ç§‘æŠ€æ„Ÿåº•éƒ¨å¯¼èˆª -->
  <view class="tech-bottom-nav">
    <view class="nav-bg"></view>
    <view class="tech-nav-item {{activeTab === 'home' ? 'active' : ''}}" bindtap="switchTab" data-tab="home">
      <view class="nav-icon-container">
        <image src="/assets/icons/home.svg" class="nav-icon-img" mode="aspectFit" />
        <view class="nav-icon-glow"></view>
      </view>
      <text class="nav-label">é¦–é¡µ</text>
    </view>
    <view class="tech-nav-item" bindtap="navigateToDevice">
      <view class="nav-icon-container">
        <image src="/assets/icons/device.svg" class="nav-icon-img" mode="aspectFit" />
        <view class="nav-icon-glow"></view>
      </view>
      <text class="nav-label">è®¾å¤‡</text>
    </view>
    <view class="tech-nav-item {{activeTab === 'messages' ? 'active' : ''}}" bindtap="switchTab" data-tab="messages">
      <view class="nav-icon-container">
        <image src="/assets/icons/message.svg" class="nav-icon-img" mode="aspectFit" />
        <view class="nav-icon-glow"></view>
        <view class="nav-badge" wx:if="{{messages.length > 0}}">{{messages.length > 99 ? '99+' : messages.length}}</view>
      </view>
      <text class="nav-label">æ¶ˆæ¯</text>
    </view>
    <view class="tech-nav-item {{activeTab === 'settings' ? 'active' : ''}}" bindtap="switchTab" data-tab="settings">
      <view class="nav-icon-container">
        <image src="/assets/icons/settings.svg" class="nav-icon-img" mode="aspectFit" />
        <view class="nav-icon-glow"></view>
      </view>
      <text class="nav-label">è®¾ç½®</text>
    </view>
  </view>

  <!-- ç§‘æŠ€æ„Ÿæµ‹è¯•å¯¹è¯æ¡† -->
  <view class="tech-dialog-mask" wx:if="{{showTestDialog}}" bindtap="hideTestDialog">
    <view class="tech-dialog" catchtap="stopPropagation">
      <view class="dialog-header-tech">
        <text class="dialog-title">æµ‹è¯•æ¶ˆæ¯å‘é€</text>
        <view class="dialog-close-tech" bindtap="hideTestDialog">Ã—</view>
      </view>
      <view class="dialog-body-tech">
        <view class="tech-test-option" bindtap="sendQuickTest">
          <view class="test-option-glow green"></view>
          <view class="test-option-icon green">âš¡</view>
          <text class="test-option-label">å¿«é€Ÿæµ‹è¯•</text>
        </view>
        <view class="tech-test-option" bindtap="sendJsonTest">
          <view class="test-option-glow blue"></view>
          <view class="test-option-icon blue">ğŸ“¦</view>
          <text class="test-option-label">JSON æµ‹è¯•</text>
        </view>
        <view class="tech-test-option" bindtap="sendCustomTest">
          <view class="test-option-glow orange"></view>
          <view class="test-option-icon orange">âœ</view>
          <text class="test-option-label">è‡ªå®šä¹‰</text>
        </view>
      </view>
    </view>
  </view>
</view>
